<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片 - OpenClaw 文档</title>
    <link rel="stylesheet" href="../assets/css/style.css?v=3">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">

            <div class="nav-section">
                <span class="nav-section-title">入门指南</span>
                <a href="../start/getting-started.html">快速入门</a>
                <a href="../start/wizard.html">向导</a>
                <a href="../start/pairing.html">配对</a>
                <a href="../start/setup.html">设置</a>
                <a href="../start/openclaw.html">OpenClaw 助手</a>
                <a href="../start/hubs.html">文档中心</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">网关配置</span>
                <a href="../gateway/configuration.html">配置</a>
                <a href="../gateway/configuration-examples.html">配置示例</a>
                <a href="../gateway/security.html">安全</a>
                <a href="../gateway/remote.html">远程访问</a>
                <a href="../gateway/tailscale.html">Tailscale</a>
                <a href="../gateway/multiple-gateways.html">多网关</a>
                <a href="../gateway/discovery.html">发现机制</a>
                <a href="../environment.html">环境变量</a>
                <a href="../logging.html">日志配置</a>
                <a href="../network.html">网络配置</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">消息渠道</span>
                <a href="../channels/whatsapp.html">WhatsApp</a>
                <a href="../channels/telegram.html">Telegram</a>
                <a href="../channels/discord.html">Discord</a>
                <a href="../channels/mattermost.html">Mattermost</a>
                <a href="../channels/imessage.html">iMessage</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Web 界面</span>
                <a href="../web/webchat.html">WebChat</a>
                <a href="../web/control-ui.html">控制界面</a>
                <a href="../web/dashboard.html">控制台</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">核心概念</span>
                <a href="../concepts/streaming.html">流式传输</a>
                <a href="../concepts/groups.html">群组</a>
                <a href="../concepts/group-messages.html">群组消息</a>
                <a href="../concepts/multi-agent.html">多代理路由</a>
                <a href="../concepts/session.html">会话</a>
                <a href="../broadcast-groups.html">广播群组</a>
                <a href="../multi-agent-sandbox-tools.html">多代理沙盒</a>
                <a href="../date-time.html">日期时间</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">自动化</span>
                <a href="../automation/cron-jobs.html">定时任务</a>
                <a href="../automation/webhook.html">Webhooks</a>
                <a href="../automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                <a href="../hooks.html">钩子系统</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">工具与技能</span>
                <a href="../tools/slash-commands.html">斜杠命令</a>
                <a href="../tools/skills.html">技能</a>
                <a href="../tools/skills-config.html">技能配置</a>
                <a href="../tools/web.html">Web 工具</a>
                <a href="../brave-search.html">Brave 搜索</a>
                <a href="../perplexity.html">Perplexity</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">安装与平台</span>
                <a href="../install/updating.html">更新</a>
                <a href="../install/nix.html">Nix 模式</a>
                <a href="../platforms/macos.html">macOS</a>
                <a href="../platforms/ios.html">iOS</a>
                <a href="../platforms/android.html">Android</a>
                <a href="../platforms/windows.html">Windows (WSL2)</a>
                <a href="../platforms/linux.html">Linux</a>
                <a href="../northflank.html">Northflank 部署</a>
                <a href="../bedrock.html">AWS Bedrock</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">节点与媒体</span>
                <a href="../nodes/index.html">节点</a>
                <a href="../nodes/images.html">图片</a>
                <a href="../nodes/audio.html">音频</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">CLI 与调试</span>
                <a href="../cli/index.html">CLI 参考</a>
                <a href="../debug/node-issue.html">Node 问题</a>
                <a href="../diagnostics/flags.html">诊断标志</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">实验性</span>
                <a href="../experiments/onboarding-config-protocol.html">配置协议</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">其他</span>
                <a href="../help.html">帮助</a>
            </div>

            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>图片</h1>
<h1>图像和媒体支持 — 2025-12-05</h1>
<p>WhatsApp 频道通过 <strong>Baileys Web</strong> 运行。本文档捕获发送、Gateway 和 Agent 回复的当前媒体处理规则。</p>
<h2>目标</h2>
<ul>
<li>通过 <code>openclaw message send --media</code> 发送带可选标题的媒体。</li>
<li>允许 Web 收件箱的自动回复包含媒体以及文本。</li>
<li>保持每种类型限制合理且可预测。</li>
</ul>
<h2>CLI 表面</h2>
<ul>
<li><code>openclaw message send --media &lt;path-or-url&gt; [--message &lt;caption&gt;]</code><ul>
<li><code>--media</code> 可选；标题可以为空用于仅媒体发送。</li>
<li><code>--dry-run</code> 打印解析的负载；<code>--json</code> 发出 <code>{ channel, to, messageId, mediaUrl, caption }</code>。</li>
</ul>
</li>
</ul>
<h2>WhatsApp Web 频道行为</h2>
<ul>
<li>输入：本地文件路径 <strong>或</strong> HTTP(S) URL。</li>
<li>流程：加载到 Buffer，检测媒体类型，并构建正确的负载：<ul>
<li><strong>图像：</strong> 调整大小并重新压缩为 JPEG（最大边 2048px），目标 <code>agents.defaults.mediaMaxMb</code>（默认 5 MB），上限为 6 MB。</li>
<li><strong>音频/语音/视频：</strong> 直通高达 16 MB；音频作为语音笔记发送（<code>ptt: true</code>）。</li>
<li><strong>文档：</strong> 其他任何东西，高达 100 MB，尽可能保留文件名。</li>
</ul>
</li>
<li>WhatsApp GIF 风格播放：发送带 <code>gifPlayback: true</code> 的 MP4（CLI: <code>--gif-playback</code>）以便移动客户端内联循环。</li>
<li>MIME 检测优先使用魔数，然后是 headers，然后是文件扩展名。</li>
<li>标题来自 <code>--message</code> 或 <code>reply.text</code>；允许空标题。</li>
<li>日志记录：非详细显示 <code>↩️</code>/<code>✅</code>；详细包括大小和源路径/URL。</li>
</ul>
<h2>自动回复管道</h2>
<ul>
<li><code>getReplyFromConfig</code> 返回 <code>{ text?, mediaUrl?, mediaUrls? }</code>。</li>
<li>当存在媒体时，Web 发送器使用与 <code>openclaw message send</code> 相同的管道解析本地路径或 URL。</li>
<li>如果提供多个媒体条目，则顺序发送。</li>
</ul>
<h2>入站媒体到命令（Pi）</h2>
<ul>
<li>当入站 Web 消息包含媒体时，OpenClaw 下载到临时文件并暴露模板变量：<ul>
<li>入站媒体的 <code>{{MediaUrl}}</code> 伪 URL。</li>
<li>运行命令前写入的本地临时路径 <code>{{MediaPath}}</code>。</li>
</ul>
</li>
<li>当启用每会话 Docker 沙盒时，入站媒体被复制到沙盒工作区，<code>MediaPath</code>/<code>MediaUrl</code> 被重写为相对路径如 <code>media/inbound/&lt;filename&gt;</code>。</li>
<li>媒体理解（如果通过 <code>tools.media.*</code> 或共享 <code>tools.media.models</code> 配置）在模板化之前运行，并可以在 <code>Body</code> 中插入 <code>[Image]</code>、<code>[Audio]</code> 和 <code>[Video]</code> 块。<ul>
<li>音频设置 <code>{{Transcript}}</code> 并使用转录本进行命令解析，以便斜杠命令仍然有效。</li>
<li>视频和图像描述保留任何标题文本用于命令解析。</li>
</ul>
</li>
<li>默认情况下仅处理第一个匹配的图像/音频/视频附件；设置 <code>tools.media.&lt;cap&gt;.attachments</code> 以处理多个附件。</li>
</ul>
<h2>限制和错误</h2>
<p><strong>出站发送上限（WhatsApp Web 发送）</strong></p>
<ul>
<li>图像：重新压缩后约 6 MB 上限。</li>
<li>音频/语音/视频：16 MB 上限；文档：100 MB 上限。</li>
<li>超大或不可读媒体 → 日志中的清晰错误并跳过回复。</li>
</ul>
<p><strong>媒体理解上限（转录/描述）</strong></p>
<ul>
<li>图像默认：10 MB（<code>tools.media.image.maxBytes</code>）。</li>
<li>音频默认：20 MB（<code>tools.media.audio.maxBytes</code>）。</li>
<li>视频默认：50 MB（<code>tools.media.video.maxBytes</code>）。</li>
<li>超大媒体跳过理解，但回复仍通过原始正文进行。</li>
</ul>
<h2>测试说明</h2>
<ul>
<li>覆盖图像/音频/文档情况的发送 + 回复流程。</li>
<li>验证图像的重新压缩（大小限制）和音频的语音笔记标志。</li>
<li>确保多媒体回复作为顺序发送扇出。</li>
</ul>

        </div>
    </main>

    <script src="../assets/js/main.js?v=3"></script>
</body>
</html>
