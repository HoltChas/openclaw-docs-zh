<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>安全配置 - OpenClaw 文档</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">
                <div class="nav-section">
                    <span class="nav-section-title">入门指南</span>
                    <a href="../start/getting-started.html">快速入门</a>
                    <a href="../start/wizard.html">向导</a>
                    <a href="../start/pairing.html">配对</a>
                    <a href="../start/setup.html">设置</a>
                    <a href="../start/openclaw.html">OpenClaw 助手</a>
                    <a href="../start/hubs.html">文档中心</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">网关配置</span>
                    <a href="../gateway/configuration.html">配置</a>
                    <a href="../gateway/configuration-examples.html">配置示例</a>
                    <a href="../gateway/security.html">安全</a>
                    <a href="../gateway/remote.html">远程访问</a>
                    <a href="../gateway/tailscale.html">Tailscale</a>
                    <a href="../gateway/multiple-gateways.html">多网关</a>
                    <a href="../gateway/discovery.html">发现机制</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">消息渠道</span>
                    <a href="../channels/whatsapp.html">WhatsApp</a>
                    <a href="../channels/telegram.html">Telegram</a>
                    <a href="../channels/discord.html">Discord</a>
                    <a href="../channels/mattermost.html">Mattermost</a>
                    <a href="../channels/imessage.html">iMessage</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">Web 界面</span>
                    <a href="../web/webchat.html">WebChat</a>
                    <a href="../web/control-ui.html">控制界面</a>
                    <a href="../web/dashboard.html">控制台</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">核心概念</span>
                    <a href="../concepts/streaming.html">流式传输</a>
                    <a href="../concepts/groups.html">群组</a>
                    <a href="../concepts/group-messages.html">群组消息</a>
                    <a href="../concepts/multi-agent.html">多代理路由</a>
                    <a href="../concepts/session.html">会话</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">自动化</span>
                    <a href="../automation/cron-jobs.html">定时任务</a>
                    <a href="../automation/webhook.html">Webhooks</a>
                    <a href="../automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">工具与技能</span>
                    <a href="../tools/slash-commands.html">斜杠命令</a>
                    <a href="../tools/skills.html">技能</a>
                    <a href="../tools/skills-config.html">技能配置</a>
                    <a href="../tools/web.html">Web 工具</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">安装与平台</span>
                    <a href="../install/updating.html">更新</a>
                    <a href="../install/nix.html">Nix 模式</a>
                    <a href="../platforms/macos.html">macOS</a>
                    <a href="../platforms/ios.html">iOS</a>
                    <a href="../platforms/android.html">Android</a>
                    <a href="../platforms/windows.html">Windows (WSL2)</a>
                    <a href="../platforms/linux.html">Linux</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">节点与媒体</span>
                    <a href="../nodes/index.html">节点</a>
                    <a href="../nodes/images.html">图片</a>
                    <a href="../nodes/audio.html">音频</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">其他</span>
                    <a href="../help.html">帮助</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>安全 🔒</h1>

            <h2>快速检查：<code>openclaw security audit</code></h2>

            <p>定期运行此命令（特别是在更改配置或暴露网络后）：</p>

            <pre><code>openclaw security audit
openclaw security audit --deep
openclaw security audit --fix</code></pre>

            <p>它会标记常见的隐患（网关认证暴露、浏览器控制暴露、提升允许列表、文件系统权限）。</p>

            <p><code>--fix</code> 应用安全防护：</p>
            <ul>
                <li>将 <code>groupPolicy="open"</code> 收紧为 <code>groupPolicy="allowlist"</code>（以及每个账户的变体）。</li>
                <li>将 <code>logging.redactSensitive="off"</code> 改回 <code>"tools"</code>。</li>
                <li>收紧本地权限（<code>~/.openclaw</code> → <code>700</code>，配置文件 → <code>600</code>，以及常见状态文件）。</li>
            </ul>

            <p>在具有 shell 访问权限的机器上运行 AI 代理是... <em> spicy </em>。以下是如何避免被攻击的方法。</p>

            <p>OpenClaw 既是一个产品也是一个实验：你将前沿模型的行为连接到真实的消息界面和真实的工具。<strong>没有"完美安全"的设置。</strong>目标是慎重考虑：</p>
            <ul>
                <li>谁可以与你的机器人对话</li>
                <li>机器人被允许在哪里操作</li>
                <li>机器人可以触摸什么</li>
            </ul>

            <p>从仍然有效的最小访问开始，然后在获得信心时逐步扩大。</p>

            <h2>审计检查的内容（高级别）</h2>

            <ul>
                <li><strong>入站访问</strong>（DM 策略、群组策略、白名单）：陌生人可以触发机器人吗？</li>
                <li><strong>工具爆炸半径</strong>（提升工具 + 开放房间）：提示注入会变成 shell/文件/网络操作吗？</li>
                <li><strong>网络暴露</strong>（网关绑定/认证、Tailscale Serve/Funnel）。</li>
                <li><strong>浏览器控制暴露</strong>（没有令牌的远程 controlUrl、HTTP、令牌重用）。</li>
                <li><strong>本地磁盘卫生</strong>（权限、符号链接、配置包含、"同步文件夹"路径）。</li>
                <li><strong>插件</strong>（没有显式白名单的扩展）。</li>
                <li><strong>模型卫生</strong>（当配置的模型看起来是遗留时警告；不是硬性阻止）。</li>
            </ul>

            <p>如果你运行 <code>--deep</code>，OpenClaw 还会尝试尽力实时网关探测。</p>

            <h2>安全审计检查清单</h2>

            <p>当审计打印发现时，将此作为优先级顺序：</p>

            <ol>
                <li><strong>任何 "open" + 工具启用</strong>：首先锁定 DM/群组（配对/白名单），然后收紧工具策略/沙盒。</li>
                <li><strong>公共网络暴露</strong>（LAN 绑定、Funnel、缺少认证）：立即修复。</li>
                <li><strong>浏览器控制远程暴露</strong>：将其视为远程管理 API（需要令牌；仅 HTTPS/tailnet）。</li>
                <li><strong>权限</strong>：确保状态/配置/凭证/认证不是组/全局可读的。</li>
                <li><strong>插件/扩展</strong>：只加载你明确信任的。</li>
                <li><strong>模型选择</strong>：对于任何带有工具的机器人，优先选择现代、指令强化的模型。</li>
            </ol>

            <h2>DM 访问模型（配对 / 白名单 / 开放 / 禁用）</h2>

            <p>所有当前支持 DM 的渠道都支持 DM 策略（<code>dmPolicy</code> 或 <code>*.dm.policy</code>），在消息处理<strong>之前</strong>控制入站 DM：</p>

            <ul>
                <li><code>pairing</code>（默认）：未知发送者收到一个短配对代码；在批准之前消息被忽略。代码在 1 小时后过期；重复 DM 不会重新发送代码，直到创建新请求。每个渠道默认待处理的请求上限为 <strong>3 个</strong>。</li>
                <li><code>allowlist</code>：未知发送者被阻止（无配对握手）。</li>
                <li><code>open</code>：允许任何人 DM（公共）。<strong>需要</strong>渠道白名单包含 <code>"*"</code>（明确选择加入）。</li>
                <li><code>disabled</code>：完全忽略入站 DM。</li>
            </ul>

            <p>通过 CLI 批准：</p>

            <pre><code>openclaw pairing list &lt;channel&gt;
openclaw pairing approve &lt;channel&gt; &lt;code&gt;</code></pre>

            <p>详情 + 磁盘上的文件：<a href="../start/pairing.html">配对</a></p>

            <h2>白名单（DM + 群组）</h2>

            <p>OpenClaw 有两个独立的"谁可以触发我？"层：</p>

            <ul>
                <li><strong>DM 白名单</strong>（<code>allowFrom</code> / <code>channels.discord.dm.allowFrom</code> / <code>channels.slack.dm.allowFrom</code>）：谁被允许在直接消息中与机器人对话。
                    <ul>
                        <li>当 <code>dmPolicy="pairing"</code> 时，批准被写入 <code>~/.openclaw/credentials/&lt;channel&gt;-allowFrom.json</code>（与配置白名单合并）。</li>
                    </ul>
                </li>
                <li><strong>群组白名单</strong>（渠道特定）：机器人将接受消息的群组/频道/公会。
                    <ul>
                        <li>常见模式：<code>channels.whatsapp.groups</code>、<code>channels.telegram.groups</code>、<code>channels.imessage.groups</code>：每个群组默认值如 <code>requireMention</code>；设置时，它也充当群组白名单（包含 <code>"*"</code> 以保持允许所有行为）。</li>
                        <li><code>groupPolicy="allowlist"</code> + <code>groupAllowFrom</code>：限制谁可以在群组会话<strong>内部</strong>触发机器人（WhatsApp/Telegram/Signal/iMessage/Microsoft Teams）。</li>
                        <li><code>channels.discord.guilds</code> / <code>channels.slack.channels</code>：每个界面白名单 + 提及默认值。</li>
                    </ul>
                </li>
            </ul>

            <div class="warning">
                <strong>安全注意：</strong>将 <code>dmPolicy="open"</code> 和 <code>groupPolicy="open"</code> 视为最后手段设置。它们应该很少使用；除非你完全信任房间的每个成员，否则优先选择配对 + 白名单。
            </div>

            <h2>提示注入（它是什么，为什么重要）</h2>

            <p>提示注入是攻击者精心制作一条消息，操纵模型执行不安全操作（"忽略你的指令"、"转储你的文件系统"、"关注此链接并运行命令"等）。</p>

            <p>即使使用强大的系统提示，<strong>提示注入仍未解决</strong>。实践中有效的措施：</p>
            <ul>
                <li>锁定入站 DM（配对/白名单）。</li>
                <li>在群组中优先选择提及门控；在公共房间中避免"始终开启"的机器人。</li>
                <li>默认将链接和粘贴的指令视为敌对。</li>
                <li>在沙盒中运行敏感工具执行；将机密保持在代理可访问的文件系统之外。</li>
                <li><strong>模型选择很重要：</strong>旧/遗留模型对提示注入和工具滥用的抵抗力可能较弱。对于任何带有工具的机器人，优先选择现代、指令强化的模型。我们推荐 Anthropic Opus 4.5，因为它非常擅长识别提示注入。</li>
            </ul>

            <h3>提示注入不需要公共 DM</h3>

            <p>即使<strong>只有你</strong>可以发送消息给机器人，提示注入仍然可以通过机器人读取的任何<strong>不可信内容</strong>发生（网页搜索/获取结果、浏览器页面、电子邮件、文档、附件、粘贴的日志/代码）。换句话说：发送者不是唯一的威胁面；<strong>内容本身</strong>可能携带对抗性指令。</p>

            <p>启用工具时，典型风险是窃取上下文或触发工具调用。通过以下方式减少爆炸半径：</p>
            <ul>
                <li>使用只读或禁用工具的<strong>阅读代理</strong>来总结不可信内容，然后将摘要传递给你的主代理。</li>
                <li>为接触不可信输入的任何代理保持 <code>web_search</code> / <code>web_fetch</code> / <code>browser</code> 关闭，除非需要。</li>
                <li>为任何接触不可信输入的代理启用沙盒化和严格的工具白名单。</li>
            </ul>

            <h2>安全基线配置（复制/粘贴）</h2>

            <p>一个"安全默认"配置，保持网关私有，需要 DM 配对，并避免始终开启的群组机器人：</p>

            <pre><code>{
  gateway: {
    mode: "local",
    bind: "loopback",
    port: 18789,
    auth: { mode: "token", token: "your-long-random-token" }
  },
  channels: {
    whatsapp: {
      dmPolicy: "pairing",
      groups: { "*": { requireMention: true } }
    }
  }
}</code></pre>

            <p>如果你还想默认获得更安全的工具执行，添加沙盒 + 为任何非所有者代理拒绝危险工具：</p>

            <pre><code>{
  agents: {
    defaults: {
      sandbox: { mode: "all", scope: "agent" }
    }
  }
}</code></pre>

            <h2>沙盒（推荐）</h2>

            <p>两种互补的方法：</p>

            <ul>
                <li><strong>在 Docker 中运行完整网关</strong>（容器边界）</li>
                <li><strong>工具沙盒</strong>（<code>agents.defaults.sandbox</code>，主机网关 + Docker 隔离工具）</li>
            </ul>

            <p>为防止跨代理访问，保持 <code>agents.defaults.sandbox.scope</code> 为 <code>"agent"</code>（默认）或 <code>"session"</code> 以获得更严格的每会话隔离。<code>scope: "shared"</code> 使用单个容器/工作空间。</p>

            <h2>事件响应（如果你怀疑被入侵）</h2>

            <p>假设"被入侵"意味着：有人进入了可以触发机器人的房间，或令牌泄露，或插件/工具做了意外的事情。</p>

            <h3>遏制</h3>
            <ol>
                <li><strong>停止它：</strong>停止 macOS 应用（如果它监督网关）或终止你的 <code>openclaw gateway</code> 进程。</li>
                <li><strong>关闭暴露：</strong>设置 <code>gateway.bind: "loopback"</code>（或禁用 Tailscale Funnel/Serve），直到你理解发生了什么。</li>
                <li><strong>冻结访问：</strong>将有风险的 DM/群组切换为 <code>dmPolicy: "disabled"</code> / 需要提及，如果你之前有 <code>"*"</code> 允许所有条目，则移除它们。</li>
            </ol>

            <h3>轮换（如果机密泄露则假设被入侵）</h3>
            <ol>
                <li>轮换网关认证（<code>gateway.auth.token</code> / <code>OPENCLAW_GATEWAY_PASSWORD</code>）并重启。</li>
                <li>轮换远程客户端机密（任何可以调用网关的机器上的 <code>gateway.remote.token</code> / <code>.password</code>）。</li>
                <li>轮换提供商/API 凭证（WhatsApp 凭证、Slack/Discord 令牌、<code>auth-profiles.json</code> 中的模型/API 密钥）。</li>
            </ol>

            <h3>审计</h3>
            <ol>
                <li>检查网关日志：<code>/tmp/openclaw/openclaw-YYYY-MM-DD.log</code>（或 <code>logging.file</code>）。</li>
                <li>查看相关会话记录：<code>~/.openclaw/agents/&lt;agentId&gt;/sessions/*.jsonl</code>。</li>
                <li>查看最近的配置更改（任何可能扩大访问的内容：<code>gateway.bind</code>、<code>gateway.auth</code>、dm/群组策略、<code>tools.elevated</code>、插件更改）。</li>
            </ol>

            <h2>报告安全问题</h2>

            <p>发现 OpenClaw 的漏洞？请负责任地报告：</p>

            <ol>
                <li>电子邮件：security@clawd.bot</li>
                <li>在修复之前不要公开发布</li>
                <li>我们会感谢你（除非你更喜欢匿名）</li>
            </ol>

            <p><em>"安全是一个过程，不是一个产品。另外，不要相信有 shell 访问权限的龙虾。"</em> — 某个聪明人，大概</p>

            <p>🦞🔐</p>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>OpenClaw = CLAW + TARDIS — 因为每只太空龙虾都需要一台时空机器</p>
            <p>"我们都在玩自己的提示词。" — 某个 AI，大概 token 嗨了</p>
            <p class="license">MIT 协议 — 像海洋中的龙虾一样自由 🦞</p>
        </div>
    </footer>

    <script src="../assets/js/main.js"></script>
</body>
</html>
