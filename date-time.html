<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>日期时间 - OpenClaw 文档</title>
    <link rel="stylesheet" href="assets/css/style.css?v=3">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">

            <div class="nav-section">
                <span class="nav-section-title">入门指南</span>
                <a href="start/getting-started.html">快速入门</a>
                <a href="start/wizard.html">向导</a>
                <a href="start/pairing.html">配对</a>
                <a href="start/setup.html">设置</a>
                <a href="start/openclaw.html">OpenClaw 助手</a>
                <a href="start/hubs.html">文档中心</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">网关配置</span>
                <a href="gateway/configuration.html">配置</a>
                <a href="gateway/configuration-examples.html">配置示例</a>
                <a href="gateway/security.html">安全</a>
                <a href="gateway/remote.html">远程访问</a>
                <a href="gateway/tailscale.html">Tailscale</a>
                <a href="gateway/multiple-gateways.html">多网关</a>
                <a href="gateway/discovery.html">发现机制</a>
                <a href="environment.html">环境变量</a>
                <a href="logging.html">日志配置</a>
                <a href="network.html">网络配置</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">消息渠道</span>
                <a href="channels/whatsapp.html">WhatsApp</a>
                <a href="channels/telegram.html">Telegram</a>
                <a href="channels/discord.html">Discord</a>
                <a href="channels/mattermost.html">Mattermost</a>
                <a href="channels/imessage.html">iMessage</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Web 界面</span>
                <a href="web/webchat.html">WebChat</a>
                <a href="web/control-ui.html">控制界面</a>
                <a href="web/dashboard.html">控制台</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">核心概念</span>
                <a href="concepts/streaming.html">流式传输</a>
                <a href="concepts/groups.html">群组</a>
                <a href="concepts/group-messages.html">群组消息</a>
                <a href="concepts/multi-agent.html">多代理路由</a>
                <a href="concepts/session.html">会话</a>
                <a href="broadcast-groups.html">广播群组</a>
                <a href="multi-agent-sandbox-tools.html">多代理沙盒</a>
                <a href="date-time.html">日期时间</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">自动化</span>
                <a href="automation/cron-jobs.html">定时任务</a>
                <a href="automation/webhook.html">Webhooks</a>
                <a href="automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                <a href="hooks.html">钩子系统</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">工具与技能</span>
                <a href="tools/slash-commands.html">斜杠命令</a>
                <a href="tools/skills.html">技能</a>
                <a href="tools/skills-config.html">技能配置</a>
                <a href="tools/web.html">Web 工具</a>
                <a href="brave-search.html">Brave 搜索</a>
                <a href="perplexity.html">Perplexity</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">安装与平台</span>
                <a href="install/updating.html">更新</a>
                <a href="install/nix.html">Nix 模式</a>
                <a href="platforms/macos.html">macOS</a>
                <a href="platforms/ios.html">iOS</a>
                <a href="platforms/android.html">Android</a>
                <a href="platforms/windows.html">Windows (WSL2)</a>
                <a href="platforms/linux.html">Linux</a>
                <a href="northflank.html">Northflank 部署</a>
                <a href="bedrock.html">AWS Bedrock</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">节点与媒体</span>
                <a href="nodes/index.html">节点</a>
                <a href="nodes/images.html">图片</a>
                <a href="nodes/audio.html">音频</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">CLI 与调试</span>
                <a href="cli/index.html">CLI 参考</a>
                <a href="debug/node-issue.html">Node 问题</a>
                <a href="diagnostics/flags.html">诊断标志</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">实验性</span>
                <a href="experiments/onboarding-config-protocol.html">配置协议</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">其他</span>
                <a href="help.html">帮助</a>
            </div>

            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>日期时间</h1>
<h1>日期与时间</h1>
<p>OpenClaw 默认为<strong>传输时间戳使用主机本地时间</strong>，<strong>仅在系统提示词中使用用户时区</strong>。<br>提供者时间戳被保留，因此工具保持其原生语义（当前时间可通过 <code>session_status</code> 获得）。</p>
<h2>消息信封（默认本地）</h2>
<p>入站消息包装有时间戳（精确到分钟）：</p>
<pre><code>[Provider ... 2026-01-05 16:26 PST] message text
</code></pre>
<p>信封时间戳<strong>默认使用主机本地时间</strong>，无论提供者时区如何。</p>
<p>你可以覆盖此行为：</p>
<pre><code class="language-json5">{
  agents: {
    defaults: {
      envelopeTimezone: &quot;local&quot;, // &quot;utc&quot; | &quot;local&quot; | &quot;user&quot; | IANA 时区
      envelopeTimestamp: &quot;on&quot;, // &quot;on&quot; | &quot;off&quot;
      envelopeElapsed: &quot;on&quot; // &quot;on&quot; | &quot;off&quot;
    }
  }
}
</code></pre>
<ul>
<li><code>envelopeTimezone: &quot;utc&quot;</code> 使用 UTC</li>
<li><code>envelopeTimezone: &quot;local&quot;</code> 使用主机时区</li>
<li><code>envelopeTimezone: &quot;user&quot;</code> 使用 <code>agents.defaults.userTimezone</code>（回退到主机时区）</li>
<li>使用显式 IANA 时区（例如 <code>&quot;America/Chicago&quot;</code>）固定时区</li>
<li><code>envelopeTimestamp: &quot;off&quot;</code> 从信封头中移除绝对时间戳</li>
<li><code>envelopeElapsed: &quot;off&quot;</code> 移除经过时间后缀（<code>+2m</code> 样式）</li>
</ul>
<h3>示例</h3>
<p><strong>本地（默认）：</strong></p>
<pre><code>[WhatsApp +1555 2026-01-18 00:19 PST] hello
</code></pre>
<p><strong>用户时区：</strong></p>
<pre><code>[WhatsApp +1555 2026-01-18 00:19 CST] hello
</code></pre>
<p><strong>启用经过时间：</strong></p>
<pre><code>[WhatsApp +1555 +30s 2026-01-18T05:19Z] follow-up
</code></pre>
<h2>系统提示词：当前日期与时间</h2>
<p>如果知道用户时区，系统提示词包含一个专用的<br><strong>当前日期与时间</strong>部分，<strong>只包含时区</strong>（无时钟/时间格式）<br>以保持提示词缓存稳定：</p>
<pre><code>Time zone: America/Chicago
</code></pre>
<p>当 Agent 需要当前时间时，使用 <code>session_status</code> 工具；状态卡包含时间戳行。</p>
<h2>系统事件行（默认本地）</h2>
<p>排队插入 Agent 上下文的系统事件用与消息信封相同的时区选择（默认：主机本地）添加前缀。</p>
<pre><code>System: [2026-01-12 12:19:17 PST] Model switched.
</code></pre>
<h3>配置用户时区 + 格式</h3>
<pre><code class="language-json5">{
  agents: {
    defaults: {
      userTimezone: &quot;America/Chicago&quot;,
      timeFormat: &quot;auto&quot; // auto | 12 | 24
    }
  }
}
</code></pre>
<ul>
<li><code>userTimezone</code> 设置提示词上下文的<strong>用户本地时区</strong></li>
<li><code>timeFormat</code> 控制提示词中的<strong>12h/24h 显示</strong>。<code>auto</code> 遵循 OS 偏好。</li>
</ul>
<h2>时间格式检测（自动）</h2>
<p>当 <code>timeFormat: &quot;auto&quot;</code> 时，OpenClaw 检查 OS 偏好（macOS/Windows）<br>并回退到区域格式。检测值<strong>每个进程缓存</strong>以避免重复系统调用。</p>
<h2>工具负载 + 连接器（原始提供者时间 + 规范字段）</h2>
<p>频道工具返回<strong>提供者原生时间戳</strong>并添加规范字段以保持一致性：</p>
<ul>
<li><code>timestampMs</code>: epoch 毫秒（UTC）</li>
<li><code>timestampUtc</code>: ISO 8601 UTC 字符串</li>
</ul>
<p>保留原始提供者字段，因此不会丢失任何内容。</p>
<ul>
<li>Slack：来自 API 的类 epoch 字符串</li>
<li>Discord：UTC ISO 时间戳</li>
<li>Telegram/WhatsApp：提供者特定的数字/ISO 时间戳</li>
</ul>
<p>如果你需要本地时间，使用已知时区在下游转换。</p>
<h2>相关文档</h2>
<ul>
<li><a href="concepts/system-prompt.html">系统提示词</a></li>
<li><a href="concepts/timezone.html">时区</a></li>
<li><a href="concepts/messages.html">消息</a></li>
</ul>

        </div>
    </main>

    <script src="assets/js/main.js?v=3"></script>
</body>
</html>
