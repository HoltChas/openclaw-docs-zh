<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nix 模式 - OpenClaw 文档</title>
    <link rel="stylesheet" href="../assets/css/style.css?v=3">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">

            <div class="nav-section">
                <span class="nav-section-title">入门指南</span>
                <a href="../start/getting-started.html">快速入门</a>
                <a href="../start/wizard.html">向导</a>
                <a href="../start/pairing.html">配对</a>
                <a href="../start/setup.html">设置</a>
                <a href="../start/openclaw.html">OpenClaw 助手</a>
                <a href="../start/hubs.html">文档中心</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">网关配置</span>
                <a href="../gateway/configuration.html">配置</a>
                <a href="../gateway/configuration-examples.html">配置示例</a>
                <a href="../gateway/security.html">安全</a>
                <a href="../gateway/remote.html">远程访问</a>
                <a href="../gateway/tailscale.html">Tailscale</a>
                <a href="../gateway/multiple-gateways.html">多网关</a>
                <a href="../gateway/discovery.html">发现机制</a>
                <a href="../environment.html">环境变量</a>
                <a href="../logging.html">日志配置</a>
                <a href="../network.html">网络配置</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">消息渠道</span>
                <a href="../channels/whatsapp.html">WhatsApp</a>
                <a href="../channels/telegram.html">Telegram</a>
                <a href="../channels/discord.html">Discord</a>
                <a href="../channels/mattermost.html">Mattermost</a>
                <a href="../channels/imessage.html">iMessage</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Web 界面</span>
                <a href="../web/webchat.html">WebChat</a>
                <a href="../web/control-ui.html">控制界面</a>
                <a href="../web/dashboard.html">控制台</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">核心概念</span>
                <a href="../concepts/streaming.html">流式传输</a>
                <a href="../concepts/groups.html">群组</a>
                <a href="../concepts/group-messages.html">群组消息</a>
                <a href="../concepts/multi-agent.html">多代理路由</a>
                <a href="../concepts/session.html">会话</a>
                <a href="../broadcast-groups.html">广播群组</a>
                <a href="../multi-agent-sandbox-tools.html">多代理沙盒</a>
                <a href="../date-time.html">日期时间</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">自动化</span>
                <a href="../automation/cron-jobs.html">定时任务</a>
                <a href="../automation/webhook.html">Webhooks</a>
                <a href="../automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                <a href="../hooks.html">钩子系统</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">工具与技能</span>
                <a href="../tools/slash-commands.html">斜杠命令</a>
                <a href="../tools/skills.html">技能</a>
                <a href="../tools/skills-config.html">技能配置</a>
                <a href="../tools/web.html">Web 工具</a>
                <a href="../brave-search.html">Brave 搜索</a>
                <a href="../perplexity.html">Perplexity</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">安装与平台</span>
                <a href="../install/updating.html">更新</a>
                <a href="../install/nix.html">Nix 模式</a>
                <a href="../platforms/macos.html">macOS</a>
                <a href="../platforms/ios.html">iOS</a>
                <a href="../platforms/android.html">Android</a>
                <a href="../platforms/windows.html">Windows (WSL2)</a>
                <a href="../platforms/linux.html">Linux</a>
                <a href="../northflank.html">Northflank 部署</a>
                <a href="../bedrock.html">AWS Bedrock</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">节点与媒体</span>
                <a href="../nodes/index.html">节点</a>
                <a href="../nodes/images.html">图片</a>
                <a href="../nodes/audio.html">音频</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">CLI 与调试</span>
                <a href="../cli/index.html">CLI 参考</a>
                <a href="../debug/node-issue.html">Node 问题</a>
                <a href="../diagnostics/flags.html">诊断标志</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">实验性</span>
                <a href="../experiments/onboarding-config-protocol.html">配置协议</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">其他</span>
                <a href="../help.html">帮助</a>
            </div>

            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>Nix 模式</h1>
<h1>Nix 安装</h1>
<p>使用 Nix 运行 OpenClaw 的推荐方式是通过 <strong><a href="https://github.com/openclaw/nix-openclaw">nix-openclaw</a></strong> —— 一个包含电池的 Home Manager 模块。</p>
<h2>快速开始</h2>
<p>将这段粘贴给你的 AI 代理（Claude、Cursor 等）：</p>
<pre><code class="language-text">我想在我的 Mac 上设置 nix-openclaw。
仓库：github:openclaw/nix-openclaw

我需要你做的：
1. 检查是否安装了 Determinate Nix（如果没有，安装它）
2. 使用 templates/agent-first/flake.nix 在 ~/code/openclaw-local 创建本地 flake
3. 帮我创建 Telegram 机器人（@BotFather）并获取我的聊天 ID（@userinfobot）
4. 设置 secrets（机器人 token、Anthropic 密钥）- 纯文本文件在 ~/.secrets/ 也可以
5. 填写模板占位符并运行 home-manager switch
6. 验证：launchd 运行中，机器人响应消息

参考 nix-openclaw README 了解模块选项。
</code></pre>
<blockquote>
<p><strong>📦 完整指南：<a href="https://github.com/openclaw/nix-openclaw">github.com/openclaw/nix-openclaw</a></strong></p>
<p>nix-openclaw 仓库是 Nix 安装的真相来源。本页只是一个快速概述。</p>
</blockquote>
<h2>你得到什么</h2>
<ul>
<li>Gateway + macOS 应用 + 工具（whisper、spotify、cameras）—— 全部固定</li>
<li>重启后仍然存活的 Launchd 服务</li>
<li>声明式配置的插件系统</li>
<li>即时回滚：<code>home-manager switch --rollback</code></li>
</ul>
<hr>
<h2>Nix 模式运行时行为</h2>
<p>当设置 <code>OPENCLAW_NIX_MODE=1</code> 时（nix-openclaw 自动设置）：</p>
<p>OpenClaw 支持 <strong>Nix 模式</strong>，使配置确定化并禁用自动安装流程。<br>通过导出启用它：</p>
<pre><code class="language-bash">OPENCLAW_NIX_MODE=1
</code></pre>
<p>在 macOS 上，GUI 应用不会自动继承 shell 环境变量。你也可以通过 defaults 启用 Nix 模式：</p>
<pre><code class="language-bash">defaults write bot.molt.mac openclaw.nixMode -bool true
</code></pre>
<h3>配置 + 状态路径</h3>
<p>OpenClaw 从 <code>OPENCLAW_CONFIG_PATH</code> 读取 JSON5 配置，并将可变数据存储在 <code>OPENCLAW_STATE_DIR</code>。</p>
<ul>
<li><code>OPENCLAW_STATE_DIR</code>（默认：<code>~/.openclaw</code>）</li>
<li><code>OPENCLAW_CONFIG_PATH</code>（默认：<code>$OPENCLAW_STATE_DIR/openclaw.json</code>）</li>
</ul>
<p>在 Nix 下运行时，显式设置这些为 Nix 管理的位置，以便运行时状态和配置保持在不<br>the immutable store 之外。</p>
<h3>Nix 模式下的运行时行为</h3>
<ul>
<li>禁用自动安装和自修改流程</li>
<li>缺失依赖显示 Nix 特定的修复消息</li>
<li>当存在时，UI 显示只读 Nix 模式横幅</li>
</ul>
<h2>打包说明（macOS）</h2>
<p>macOS 打包流程期望在以下位置有一个稳定的 Info.plist 模板：</p>
<pre><code>apps/macos/Sources/OpenClaw/Resources/Info.plist
</code></pre>
<p><a href="https://github.com/openclaw/openclaw/blob/main/scripts/package-mac-app.sh"><code>scripts/package-mac-app.sh</code></a> 将此模板复制到应用包中并修补动态字段<br>（bundle ID、版本/构建、Git SHA、Sparkle 密钥）。这保持 plist 对 SwiftPM<br>打包和 Nix 构建（不依赖完整 Xcode 工具链）是确定性的。</p>
<h2>相关</h2>
<ul>
<li><a href="https://github.com/openclaw/nix-openclaw">nix-openclaw</a> —— 完整设置指南</li>
<li><a href="/start/wizard">向导</a> —— 非 Nix CLI 设置</li>
<li><a href="/install/docker">Docker</a> —— 容器化设置</li>
</ul>

        </div>
    </main>

    <script src="../assets/js/main.js?v=3"></script>
</body>
</html>
