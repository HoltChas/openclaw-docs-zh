<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>向导 - OpenClaw 文档</title>
    <link rel="stylesheet" href="../assets/css/style.css">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">
                <div class="nav-section">
                    <span class="nav-section-title">入门指南</span>
                    <a href="../start/getting-started.html">快速入门</a>
                    <a href="../start/wizard.html">向导</a>
                    <a href="../start/pairing.html">配对</a>
                    <a href="../start/setup.html">设置</a>
                    <a href="../start/openclaw.html">OpenClaw 助手</a>
                    <a href="../start/hubs.html">文档中心</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">网关配置</span>
                    <a href="../gateway/configuration.html">配置</a>
                    <a href="../gateway/configuration-examples.html">配置示例</a>
                    <a href="../gateway/security.html">安全</a>
                    <a href="../gateway/remote.html">远程访问</a>
                    <a href="../gateway/tailscale.html">Tailscale</a>
                    <a href="../gateway/multiple-gateways.html">多网关</a>
                    <a href="../gateway/discovery.html">发现机制</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">消息渠道</span>
                    <a href="../channels/whatsapp.html">WhatsApp</a>
                    <a href="../channels/telegram.html">Telegram</a>
                    <a href="../channels/discord.html">Discord</a>
                    <a href="../channels/mattermost.html">Mattermost</a>
                    <a href="../channels/imessage.html">iMessage</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">Web 界面</span>
                    <a href="../web/webchat.html">WebChat</a>
                    <a href="../web/control-ui.html">控制界面</a>
                    <a href="../web/dashboard.html">控制台</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">核心概念</span>
                    <a href="../concepts/streaming.html">流式传输</a>
                    <a href="../concepts/groups.html">群组</a>
                    <a href="../concepts/group-messages.html">群组消息</a>
                    <a href="../concepts/multi-agent.html">多代理路由</a>
                    <a href="../concepts/session.html">会话</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">自动化</span>
                    <a href="../automation/cron-jobs.html">定时任务</a>
                    <a href="../automation/webhook.html">Webhooks</a>
                    <a href="../automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">工具与技能</span>
                    <a href="../tools/slash-commands.html">斜杠命令</a>
                    <a href="../tools/skills.html">技能</a>
                    <a href="../tools/skills-config.html">技能配置</a>
                    <a href="../tools/web.html">Web 工具</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">安装与平台</span>
                    <a href="../install/updating.html">更新</a>
                    <a href="../install/nix.html">Nix 模式</a>
                    <a href="../platforms/macos.html">macOS</a>
                    <a href="../platforms/ios.html">iOS</a>
                    <a href="../platforms/android.html">Android</a>
                    <a href="../platforms/windows.html">Windows (WSL2)</a>
                    <a href="../platforms/linux.html">Linux</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">节点与媒体</span>
                    <a href="../nodes/index.html">节点</a>
                    <a href="../nodes/images.html">图片</a>
                    <a href="../nodes/audio.html">音频</a>
                </div>
                <div class="nav-section">
                    <span class="nav-section-title">其他</span>
                    <a href="../help.html">帮助</a>
                </div>
            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>引导向导 (CLI)</h1>
            
            <p>引导向导是<strong>推荐</strong>的在 macOS、Linux 或 Windows（通过 WSL2；强烈推荐）上设置 OpenClaw 的方式。它在一个引导流程中配置本地网关或远程网关连接，以及渠道、技能和工作空间默认值。</p>

            <p>主要入口点：</p>
            <pre><code>openclaw onboard</code></pre>

            <p>重新配置：</p>
            <pre><code>openclaw configure</code></pre>

            <p>推荐：设置 Brave Search API 密钥，以便代理可以使用 <code>web_search</code>（<code>web_fetch</code> 无需密钥即可工作）。最简单的路径：<code>openclaw configure --section web</code>，它会存储 <code>tools.web.search.apiKey</code>。文档：<a href="../tools/web.html">Web 工具</a>。</p>

            <h2>快速入门 vs 高级模式</h2>
            
            <p>向导以<strong>快速入门</strong>（默认值）vs <strong>高级</strong>（完全控制）开始。</p>

            <p><strong>快速入门</strong>保持默认设置：</p>
            <ul>
                <li>本地网关（回环）</li>
                <li>工作空间默认（或现有工作空间）</li>
                <li>网关端口 <strong>18789</strong></li>
                <li>网关认证 <strong>Token</strong>（自动生成，即使在回环上）</li>
                <li>Tailscale 暴露 <strong>关闭</strong></li>
                <li>Telegram + WhatsApp DM 默认为 <strong>白名单</strong>（会提示你输入电话号码）</li>
            </ul>

            <p><strong>高级</strong>模式暴露每个步骤（模式、工作空间、网关、渠道、守护进程、技能）。</p>

            <h2>向导的功能</h2>

            <p><strong>本地模式（默认）</strong>引导你完成：</p>
            <ul>
                <li>模型/认证（OpenAI Code (Codex) 订阅 OAuth、Anthropic API 密钥（推荐）或设置令牌（粘贴），以及 MiniMax/GLM/Moonshot/AI Gateway 选项）</li>
                <li>工作空间位置 + 引导文件</li>
                <li>网关设置（端口/绑定/认证/tailscale）</li>
                <li>提供商（Telegram、WhatsApp、Discord、Google Chat、Mattermost（插件）、Signal）</li>
                <li>守护进程安装（LaunchAgent / systemd 用户单元）</li>
                <li>健康检查</li>
                <li>技能（推荐）</li>
            </ul>

            <p><strong>远程模式</strong>仅配置本地客户端连接到其他地方的网关。它<strong>不会</strong>在远程主机上安装或更改任何内容。</p>

            <p>要添加更多隔离的代理（单独的工作空间 + 会话 + 认证），使用：</p>
            <pre><code>openclaw agents add &lt;name&gt;</code></pre>

            <p>提示：<code>--json</code> 不意味着非交互模式。对于脚本，使用 <code>--non-interactive</code>（和 <code>--workspace</code>）。</p>

            <h2>流程详情（本地）</h2>

            <h3>1) 现有配置检测</h3>
            <ul>
                <li>如果 <code>~/.openclaw/openclaw.json</code> 存在，选择<strong>保留 / 修改 / 重置</strong>。</li>
                <li>重新运行向导<strong>不会</strong>擦除任何内容，除非你明确选择<strong>重置</strong>（或传递 <code>--reset</code>）。</li>
                <li>如果配置无效或包含遗留密钥，向导会停止并要求你在继续之前运行 <code>openclaw doctor</code>。</li>
                <li>重置使用 <code>trash</code>（从不使用 <code>rm</code>）并提供范围：仅配置、配置 + 凭证 + 会话、完全重置（也删除工作空间）</li>
            </ul>

            <h3>2) 模型/认证</h3>
            <ul>
                <li><strong>Anthropic API 密钥（推荐）</strong>：如果存在则使用 <code>ANTHROPIC_API_KEY</code>，或提示输入密钥，然后保存供守护进程使用。</li>
                <li><strong>Anthropic OAuth (Claude Code CLI)</strong>：在 macOS 上，向导检查钥匙串项目 "Claude Code-credentials"（选择 "始终允许" 以避免 launchd 启动阻塞）；在 Linux/Windows 上，如果存在则重用 <code>~/.claude/.credentials.json</code>。</li>
                <li><strong>Anthropic 令牌（粘贴设置令牌）</strong>：在任何机器上运行 <code>claude setup-token</code>，然后粘贴令牌（你可以命名它；空白 = 默认）。</li>
                <li><strong>OpenAI Code (Codex) 订阅 (Codex CLI)</strong>：如果存在 <code>~/.codex/auth.json</code>，向导可以重用它。</li>
                <li><strong>OpenAI Code (Codex) 订阅 (OAuth)</strong>：浏览器流程；粘贴 <code>code#state</code>。当模型未设置或为 <code>openai/*</code> 时，将 <code>agents.defaults.model</code> 设置为 <code>openai-codex/gpt-5.2</code>。</li>
                <li><strong>OpenAI API 密钥</strong>：如果存在则使用 <code>OPENAI_API_KEY</code>，或提示输入密钥，然后保存到 <code>~/.openclaw/.env</code> 以便 launchd 可以读取。</li>
                <li><strong>OpenCode Zen（多模型代理）</strong>：提示输入 <code>OPENCODE_API_KEY</code>（或 <code>OPENCODE_ZEN_API_KEY</code>，在 https://opencode.ai/auth 获取）。</li>
                <li><strong>API 密钥</strong>：为你存储密钥。</li>
                <li><strong>Vercel AI Gateway（多模型代理）</strong>：提示输入 <code>AI_GATEWAY_API_KEY</code>。</li>
                <li><strong>MiniMax M2.1</strong>：配置自动写入。</li>
                <li><strong>Synthetic (Anthropic-compatible)</strong>：提示输入 <code>SYNTHETIC_API_KEY</code>。</li>
                <li><strong>Moonshot (Kimi K2)</strong>：配置自动写入。</li>
                <li><strong>Kimi Code</strong>：配置自动写入。</li>
                <li><strong>跳过</strong>：尚未配置认证。</li>
            </ul>

            <p>从检测到的选项中选择默认模型（或手动输入提供商/模型）。向导运行模型检查，并在配置的模型未知或缺少认证时发出警告。</p>

            <ul>
                <li>OAuth 凭证存储在 <code>~/.openclaw/credentials/oauth.json</code>；认证配置文件存储在 <code>~/.openclaw/agents/&lt;agentId&gt;/agent/auth-profiles.json</code>（API 密钥 + OAuth）。</li>
            </ul>

            <h3>3) 工作空间</h3>
            <ul>
                <li>默认 <code>~/clawd</code>（可配置）。</li>
                <li>为代理引导仪式植入所需的工作空间文件。</li>
            </ul>

            <h3>4) 网关</h3>
            <ul>
                <li>端口、绑定、认证模式、tailscale 暴露。</li>
                <li>认证建议：即使在回环上也保持 <strong>Token</strong>，以便本地 WS 客户端必须认证。</li>
                <li>仅在完全信任每个本地进程时才禁用认证。</li>
                <li>非回环绑定仍然需要认证。</li>
            </ul>

            <h3>5) 渠道</h3>
            <ul>
                <li>WhatsApp：可选 QR 登录。</li>
                <li>Telegram：机器人令牌。</li>
                <li>Discord：机器人令牌。</li>
                <li>Google Chat：服务账号 JSON + webhook 受众。</li>
                <li>Mattermost（插件）：机器人令牌 + 基础 URL。</li>
                <li>Signal：可选 <code>signal-cli</code> 安装 + 账号配置。</li>
                <li>iMessage：本地 <code>imsg</code> CLI 路径 + 数据库访问。</li>
                <li>DM 安全：默认是配对。第一条 DM 发送一个代码；通过 <code>openclaw pairing approve &lt;channel&gt; &lt;code&gt;</code> 批准，或使用白名单。</li>
            </ul>

            <h3>6) 守护进程安装</h3>
            <ul>
                <li>macOS：LaunchAgent
                    <ul>
                        <li>需要登录用户会话；对于无头模式，使用自定义 LaunchDaemon（未提供）。</li>
                    </ul>
                </li>
                <li>Linux（和通过 WSL2 的 Windows）：systemd 用户单元
                    <ul>
                        <li>向导尝试通过 <code>loginctl enable-linger &lt;user&gt;</code> 启用 lingering，以便网关在注销后保持运行。</li>
                        <li>可能会提示输入 sudo（写入 <code>/var/lib/systemd/linger</code>）；它首先尝试不使用 sudo。</li>
                    </ul>
                </li>
                <li><strong>运行时选择：</strong>Node（推荐；WhatsApp/Telegram 需要）。<strong>不推荐</strong> Bun。</li>
            </ul>

            <h3>7) 健康检查</h3>
            <ul>
                <li>启动网关（如果需要）并运行 <code>openclaw health</code>。</li>
                <li>提示：<code>openclaw status --deep</code> 将网关健康探测添加到状态输出（需要可访问的网关）。</li>
            </ul>

            <h3>8) 技能（推荐）</h3>
            <ul>
                <li>读取可用技能并检查要求。</li>
                <li>让你选择节点管理器：<strong>npm / pnpm</strong>（不推荐 bun）。</li>
                <li>安装可选依赖（一些在 macOS 上使用 Homebrew）。</li>
            </ul>

            <h3>9) 完成</h3>
            <ul>
                <li>摘要 + 下一步，包括用于额外功能的 iOS/Android/macOS 应用。</li>
                <li>如果未检测到 GUI，向导会打印 SSH 端口转发说明以供控制 UI 使用，而不是打开浏览器。</li>
                <li>如果控制 UI 资源缺失，向导尝试构建它们；回退是 <code>pnpm ui:build</code>（自动安装 UI 依赖）。</li>
            </ul>

            <h2>远程模式</h2>

            <p>远程模式配置本地客户端连接到其他地方的网关。</p>

            <p>你将设置：</p>
            <ul>
                <li>远程网关 URL (<code>ws://...</code>)</li>
                <li>如果远程网关需要认证，则设置令牌（推荐）</li>
            </ul>

            <p>注意：</p>
            <ul>
                <li>不执行远程安装或守护进程更改。</li>
                <li>如果网关仅限回环，使用 SSH 隧道或 tailnet。</li>
                <li>发现提示：
                    <ul>
                        <li>macOS：Bonjour (<code>dns-sd</code>)</li>
                        <li>Linux：Avahi (<code>avahi-browse</code>)</li>
                    </ul>
                </li>
            </ul>

            <h2>添加另一个代理</h2>

            <p>使用 <code>openclaw agents add &lt;name&gt;</code> 创建一个具有自己工作空间、会话和认证配置文件的单独代理。不带 <code>--workspace</code> 运行会启动向导。</p>

            <p>它设置：</p>
            <ul>
                <li><code>agents.list[].name</code></li>
                <li><code>agents.list[].workspace</code></li>
                <li><code>agents.list[].agentDir</code></li>
            </ul>

            <p>注意：</p>
            <ul>
                <li>默认工作空间遵循 <code>~/clawd-&lt;agentId&gt;</code>。</li>
                <li>添加 <code>bindings</code> 以路由入站消息（向导可以执行此操作）。</li>
                <li>非交互式标志：<code>--model</code>、<code>--agent-dir</code>、<code>--bind</code>、<code>--non-interactive</code>。</li>
            </ul>

            <h2>非交互模式</h2>

            <p>使用 <code>--non-interactive</code> 来自动化或脚本化引导：</p>

            <pre><code>openclaw onboard --non-interactive \
  --mode local \
  --auth-choice apiKey \
  --anthropic-api-key "$ANTHROPIC_API_KEY" \
  --gateway-port 18789 \
  --gateway-bind loopback \
  --install-daemon \
  --daemon-runtime node \
  --skip-skills</code></pre>

            <p>添加 <code>--json</code> 以获取机器可读的摘要。</p>

            <p>Gemini 示例：</p>
            <pre><code>openclaw onboard --non-interactive \
  --mode local \
  --auth-choice gemini-api-key \
  --gemini-api-key "$GEMINI_API_KEY" \
  --gateway-port 18789 \
  --gateway-bind loopback</code></pre>

            <p>添加代理（非交互式）示例：</p>
            <pre><code>openclaw agents add work \
  --workspace ~/clawd-work \
  --model openai/gpt-5.2 \
  --bind whatsapp:biz \
  --non-interactive \
  --json</code></pre>

            <h2>向导 RPC</h2>

            <p>网关通过 RPC 暴露向导流程（<code>wizard.start</code>、<code>wizard.next</code>、<code>wizard.cancel</code>、<code>wizard.status</code>）。客户端（macOS 应用、控制 UI）可以渲染步骤，而无需重新实现引导逻辑。</p>

            <h2>Signal 设置 (signal-cli)</h2>

            <p>向导可以从 GitHub 发布版安装 <code>signal-cli</code>：</p>
            <ul>
                <li>下载适当的发布版资源。</li>
                <li>存储在 <code>~/.openclaw/tools/signal-cli/&lt;version&gt;/</code> 下。</li>
                <li>将 <code>channels.signal.cliPath</code> 写入你的配置。</li>
            </ul>

            <p>注意：</p>
            <ul>
                <li>JVM 构建需要 <strong>Java 21</strong>。</li>
                <li>原生构建在可用时使用。</li>
                <li>Windows 使用 WSL2；signal-cli 安装在 WSL 内部遵循 Linux 流程。</li>
            </ul>

            <h2>向导写入的内容</h2>

            <p><code>~/.openclaw/openclaw.json</code> 中的典型字段：</p>
            <ul>
                <li><code>agents.defaults.workspace</code></li>
                <li><code>agents.defaults.model</code> / <code>models.providers</code>（如果选择了 Minimax）</li>
                <li><code>gateway.*</code>（模式、绑定、认证、tailscale）</li>
                <li><code>channels.telegram.botToken</code>、<code>channels.discord.token</code>、<code>channels.signal.*</code>、<code>channels.imessage.*</code></li>
                <li>当你在选择期间选择加入时，渠道白名单（Slack/Discord/Matrix/Microsoft Teams）（名称在可能时解析为 ID）。</li>
                <li><code>skills.install.nodeManager</code></li>
                <li><code>wizard.lastRunAt</code>、<code>wizard.lastRunVersion</code>、<code>wizard.lastRunCommit</code>、<code>wizard.lastRunCommand</code>、<code>wizard.lastRunMode</code></li>
            </ul>

            <p><code>openclaw agents add</code> 写入 <code>agents.list[]</code> 和可选的 <code>bindings</code>。</p>

            <p>WhatsApp 凭证存储在 <code>~/.openclaw/credentials/whatsapp/&lt;accountId&gt;/</code> 下。会话存储在 <code>~/.openclaw/agents/&lt;agentId&gt;/sessions/</code> 下。</p>

            <p>一些渠道作为插件提供。当你在引导期间选择一个时，向导会在配置之前提示安装它（npm 或本地路径）。</p>

            <h2>相关文档</h2>
            <ul>
                <li>macOS 应用引导：<a href="onboarding.html">引导</a></li>
                <li>配置参考：<a href="../gateway/configuration.html">网关配置</a></li>
                <li>提供商：<a href="../channels/whatsapp.html">WhatsApp</a>、<a href="../channels/telegram.html">Telegram</a>、<a href="../channels/discord.html">Discord</a>、<a href="../channels/googlechat.html">Google Chat</a>、<a href="../channels/signal.html">Signal</a>、<a href="../channels/imessage.html">iMessage</a></li>
                <li>技能：<a href="../tools/skills.html">技能</a>、<a href="../tools/skills-config.html">技能配置</a></li>
            </ul>
        </div>
    </main>

    <footer class="footer">
        <div class="footer-content">
            <p>OpenClaw = CLAW + TARDIS — 因为每只太空龙虾都需要一台时空机器</p>
            <p>"我们都在玩自己的提示词。" — 某个 AI，大概 token 嗨了</p>
            <p class="license">MIT 协议 — 像海洋中的龙虾一样自由 🦞</p>
        </div>
    </footer>

    <script src="../assets/js/main.js"></script>
</body>
</html>
