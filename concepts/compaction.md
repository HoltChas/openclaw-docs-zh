---
summary: "上下文压缩机制"
read_when:
  - 你想了解长对话如何管理上下文窗口
  - 你需要配置自动压缩
  - 你在调试会话历史问题
---

# 上下文压缩

本文档解释 OpenClaw 如何通过压缩功能管理上下文窗口。由于"每个模型都有**上下文窗口**（它能看到的最大 token 数）"，长对话可能会超出这些限制。

## 压缩的作用

压缩会创建旧对话历史的摘要，同时保留最近的消息。摘要存储在会话的 JSONL 历史文件中，这意味着未来的请求会同时使用压缩摘要和压缩点之后的消息。

## 自动压缩

默认启用，当会话接近模型的上下文限制时自动激活。系统可能会使用新压缩的上下文重试原始请求。用户可以通过以下方式观察：
- 详细模式下的完成消息
- `/status` 命令显示压缩次数

压缩前可能会发生"静默记忆刷新"，将持久笔记保存到磁盘。

## 手动压缩

用户可以使用 `/compact` 命令强制压缩，可选添加指令：

```
/compact 专注于决策和待解决问题
```

## 压缩 vs 修剪

这是两个不同的操作：
- **压缩**：总结历史并将更改持久化到 JSONL
- **会话修剪**：仅在每次请求时在内存中裁剪工具结果

## 配置

设置位于 `agents.defaults.compaction` 下，更多详情请参阅配置页面。

## 实用技巧

- 对陈旧或臃肿的会话使用 `/compact`
- 修剪有助于减少工具结果的累积
- 需要时使用 `/new` 或 `/reset` 命令创建新会话
