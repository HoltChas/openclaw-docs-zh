<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>群组 - OpenClaw 文档</title>
    <link rel="stylesheet" href="../assets/css/style.css?v=3">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">

            <div class="nav-section">
                <span class="nav-section-title">入门指南</span>
                <a href="../start/getting-started.html">快速入门</a>
                <a href="../start/wizard.html">向导</a>
                <a href="../start/pairing.html">配对</a>
                <a href="../start/setup.html">设置</a>
                <a href="../start/openclaw.html">OpenClaw 助手</a>
                <a href="../start/hubs.html">文档中心</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">网关配置</span>
                <a href="../gateway/configuration.html">配置</a>
                <a href="../gateway/configuration-examples.html">配置示例</a>
                <a href="../gateway/security.html">安全</a>
                <a href="../gateway/remote.html">远程访问</a>
                <a href="../gateway/tailscale.html">Tailscale</a>
                <a href="../gateway/multiple-gateways.html">多网关</a>
                <a href="../gateway/discovery.html">发现机制</a>
                <a href="../environment.html">环境变量</a>
                <a href="../logging.html">日志配置</a>
                <a href="../network.html">网络配置</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">消息渠道</span>
                <a href="../channels/whatsapp.html">WhatsApp</a>
                <a href="../channels/telegram.html">Telegram</a>
                <a href="../channels/discord.html">Discord</a>
                <a href="../channels/mattermost.html">Mattermost</a>
                <a href="../channels/imessage.html">iMessage</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Web 界面</span>
                <a href="../web/webchat.html">WebChat</a>
                <a href="../web/control-ui.html">控制界面</a>
                <a href="../web/dashboard.html">控制台</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">核心概念</span>
                <a href="../concepts/streaming.html">流式传输</a>
                <a href="../concepts/groups.html">群组</a>
                <a href="../concepts/group-messages.html">群组消息</a>
                <a href="../concepts/multi-agent.html">多代理路由</a>
                <a href="../concepts/session.html">会话</a>
                <a href="../broadcast-groups.html">广播群组</a>
                <a href="../multi-agent-sandbox-tools.html">多代理沙盒</a>
                <a href="../date-time.html">日期时间</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">自动化</span>
                <a href="../automation/cron-jobs.html">定时任务</a>
                <a href="../automation/webhook.html">Webhooks</a>
                <a href="../automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                <a href="../hooks.html">钩子系统</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">工具与技能</span>
                <a href="../tools/slash-commands.html">斜杠命令</a>
                <a href="../tools/skills.html">技能</a>
                <a href="../tools/skills-config.html">技能配置</a>
                <a href="../tools/web.html">Web 工具</a>
                <a href="../brave-search.html">Brave 搜索</a>
                <a href="../perplexity.html">Perplexity</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">安装与平台</span>
                <a href="../install/updating.html">更新</a>
                <a href="../install/nix.html">Nix 模式</a>
                <a href="../platforms/macos.html">macOS</a>
                <a href="../platforms/ios.html">iOS</a>
                <a href="../platforms/android.html">Android</a>
                <a href="../platforms/windows.html">Windows (WSL2)</a>
                <a href="../platforms/linux.html">Linux</a>
                <a href="../northflank.html">Northflank 部署</a>
                <a href="../bedrock.html">AWS Bedrock</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">节点与媒体</span>
                <a href="../nodes/index.html">节点</a>
                <a href="../nodes/images.html">图片</a>
                <a href="../nodes/audio.html">音频</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">CLI 与调试</span>
                <a href="../cli/index.html">CLI 参考</a>
                <a href="../debug/node-issue.html">Node 问题</a>
                <a href="../diagnostics/flags.html">诊断标志</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">实验性</span>
                <a href="../experiments/onboarding-config-protocol.html">配置协议</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">其他</span>
                <a href="../help.html">帮助</a>
            </div>

            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>群组</h1>
<h1>群组</h1>
<p>OpenClaw 在跨界面处理群组聊天时保持一致：WhatsApp、Telegram、Discord、Slack、Signal、iMessage、Microsoft Teams。</p>
<h2>初学者介绍（2 分钟）</h2>
<p>OpenClaw&quot;生活&quot;在你自己的消息账户上。没有单独的 WhatsApp Bot 用户。<br>如果<strong>你</strong>在群组中，OpenClaw 可以看到该群组并在那里响应。</p>
<p>默认行为：</p>
<ul>
<li>群组受限（<code>groupPolicy: &quot;allowlist&quot;</code>）。</li>
<li>除非明确禁用提及门控，否则回复需要提及。</li>
</ul>
<p>翻译：白名单发送者可以通过提及触发 OpenClaw。</p>
<blockquote>
<p>太长不看</p>
<ul>
<li><strong>私聊访问</strong>由 <code>*.allowFrom</code> 控制。</li>
<li><strong>群组访问</strong>由 <code>*.groupPolicy</code> + 白名单（<code>*.groups</code>、<code>*.groupAllowFrom</code>）控制。</li>
<li><strong>回复触发</strong>由提及门控（<code>requireMention</code>、<code>/activation</code>）控制。</li>
</ul>
</blockquote>
<p>快速流程（群组消息会发生什么）：</p>
<pre><code>groupPolicy? disabled -&gt; 丢弃
groupPolicy? allowlist -&gt; 群组允许？否 -&gt; 丢弃
requireMention? 是 -&gt; 提及？否 -&gt; 仅存储用于上下文
否则 -&gt; 回复
</code></pre>
<p><img src="../images/groups-flow.svg" alt="群组消息流程"></p>
<p>如果你想要...</p>
<table>
<thead>
<tr>
<th>目标</th>
<th>设置什么</th>
</tr>
</thead>
<tbody><tr>
<td>允许所有群组但只在 @提及 时回复</td>
<td><code>groups: { &quot;*&quot;: { requireMention: true } }</code></td>
</tr>
<tr>
<td>禁用所有群组回复</td>
<td><code>groupPolicy: &quot;disabled&quot;</code></td>
</tr>
<tr>
<td>仅特定群组</td>
<td><code>groups: { &quot;&lt;group-id&gt;&quot;: { ... } }</code>（无 <code>&quot;*&quot;</code> 键）</td>
</tr>
<tr>
<td>只有你可以在群组中触发</td>
<td><code>groupPolicy: &quot;allowlist&quot;</code>, <code>groupAllowFrom: [&quot;+1555...&quot;]</code></td>
</tr>
</tbody></table>
<h2>会话键</h2>
<ul>
<li>群组会话使用 <code>agent:&lt;agentId&gt;:&lt;channel&gt;:group:&lt;id&gt;</code> 会话键（房间/频道使用 <code>agent:&lt;agentId&gt;:&lt;channel&gt;:channel:&lt;id&gt;</code>）。</li>
<li>Telegram 论坛主题将 <code>:topic:&lt;threadId&gt;</code> 添加到群组 id，因此每个主题有自己的会话。</li>
<li>直接聊天使用主会话（或如果配置的每发送者）。</li>
<li>群组会话跳过心跳。</li>
</ul>
<h2>模式：个人私聊 + 公共群组（单 Agent）</h2>
<p>可以 —— 如果你的&quot;个人&quot;流量是<strong>私聊</strong>而你的&quot;公共&quot;流量是<strong>群组</strong>，这工作得很好。</p>
<p>为什么：在单 Agent 模式下，私聊通常落在<strong>主</strong>会话键（<code>agent:main:main</code>），而群组总是使用<strong>非主</strong>会话键（<code>agent:main:&lt;channel&gt;:group:&lt;id&gt;</code>）。如果你启用沙盒，<code>mode: &quot;non-main&quot;</code>，那些群组会话在 Docker 中运行，而你的主私聊会话保持在主机上。</p>
<p>这给你一个 Agent&quot;大脑&quot;（共享工作空间 + 记忆），但两种执行姿态：</p>
<ul>
<li><strong>私聊</strong>：完整工具（主机）</li>
<li><strong>群组</strong>：沙盒 + 受限工具（Docker）</li>
</ul>
<blockquote>
<p>如果你需要真正独立的工作空间/人物（&quot;个人&quot;和&quot;公共&quot;必须永不混合），使用第二个 Agent + 绑定。参见 [多 Agent 路由(../concepts/multi-agent.html)。</p>
</blockquote>
<p>示例（主机上的私聊，沙盒群组 + 仅消息工具）：</p>
<pre><code class="language-json5">{
  agents: {
    defaults: {
      sandbox: {
        mode: &quot;non-main&quot;, // 群组/频道是非主 -&gt; 沙盒化
        scope: &quot;session&quot;, // 最强隔离（每个群组/频道一个容器）
        workspaceAccess: &quot;none&quot;
      }
    }
  },
  tools: {
    sandbox: {
      tools: {
        // 如果 allow 非空，其他所有东西被阻塞（deny 仍然获胜）。
        allow: [&quot;group:messaging&quot;, &quot;group:sessions&quot;],
        deny: [&quot;group:runtime&quot;, &quot;group:fs&quot;, &quot;group:ui&quot;, &quot;nodes&quot;, &quot;cron&quot;, &quot;gateway&quot;]
      }
</code></pre>

        </div>
    </main>

    <script src="../assets/js/main.js?v=3"></script>
</body>
</html>
