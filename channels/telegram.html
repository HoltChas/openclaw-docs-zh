<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Telegram - OpenClaw 文档</title>
    <link rel="stylesheet" href="../assets/css/style.css?v=3">
</head>
<body>
    <nav class="navbar">
        <div class="nav-container">
            <a href="../index.html" class="nav-logo">
                <span class="logo-icon">🦞</span>
                <span class="logo-text">OpenClaw 中文文档</span>
            </a>
            <button class="nav-toggle" onclick="toggleNav()">☰</button>
            <div class="nav-links" id="navLinks">

            <div class="nav-section">
                <span class="nav-section-title">入门指南</span>
                <a href="../start/getting-started.html">快速入门</a>
                <a href="../start/wizard.html">向导</a>
                <a href="../start/pairing.html">配对</a>
                <a href="../start/setup.html">设置</a>
                <a href="../start/openclaw.html">OpenClaw 助手</a>
                <a href="../start/hubs.html">文档中心</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">网关配置</span>
                <a href="../gateway/configuration.html">配置</a>
                <a href="../gateway/configuration-examples.html">配置示例</a>
                <a href="../gateway/security.html">安全</a>
                <a href="../gateway/remote.html">远程访问</a>
                <a href="../gateway/tailscale.html">Tailscale</a>
                <a href="../gateway/multiple-gateways.html">多网关</a>
                <a href="../gateway/discovery.html">发现机制</a>
                <a href="../environment.html">环境变量</a>
                <a href="../logging.html">日志配置</a>
                <a href="../network.html">网络配置</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">消息渠道</span>
                <a href="../channels/whatsapp.html">WhatsApp</a>
                <a href="../channels/telegram.html">Telegram</a>
                <a href="../channels/discord.html">Discord</a>
                <a href="../channels/mattermost.html">Mattermost</a>
                <a href="../channels/imessage.html">iMessage</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">Web 界面</span>
                <a href="../web/webchat.html">WebChat</a>
                <a href="../web/control-ui.html">控制界面</a>
                <a href="../web/dashboard.html">控制台</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">核心概念</span>
                <a href="../concepts/streaming.html">流式传输</a>
                <a href="../concepts/groups.html">群组</a>
                <a href="../concepts/group-messages.html">群组消息</a>
                <a href="../concepts/multi-agent.html">多代理路由</a>
                <a href="../concepts/session.html">会话</a>
                <a href="../broadcast-groups.html">广播群组</a>
                <a href="../multi-agent-sandbox-tools.html">多代理沙盒</a>
                <a href="../date-time.html">日期时间</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">自动化</span>
                <a href="../automation/cron-jobs.html">定时任务</a>
                <a href="../automation/webhook.html">Webhooks</a>
                <a href="../automation/gmail-pubsub.html">Gmail Pub/Sub</a>
                <a href="../hooks.html">钩子系统</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">工具与技能</span>
                <a href="../tools/slash-commands.html">斜杠命令</a>
                <a href="../tools/skills.html">技能</a>
                <a href="../tools/skills-config.html">技能配置</a>
                <a href="../tools/web.html">Web 工具</a>
                <a href="../brave-search.html">Brave 搜索</a>
                <a href="../perplexity.html">Perplexity</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">安装与平台</span>
                <a href="../install/updating.html">更新</a>
                <a href="../install/nix.html">Nix 模式</a>
                <a href="../platforms/macos.html">macOS</a>
                <a href="../platforms/ios.html">iOS</a>
                <a href="../platforms/android.html">Android</a>
                <a href="../platforms/windows.html">Windows (WSL2)</a>
                <a href="../platforms/linux.html">Linux</a>
                <a href="../northflank.html">Northflank 部署</a>
                <a href="../bedrock.html">AWS Bedrock</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">节点与媒体</span>
                <a href="../nodes/index.html">节点</a>
                <a href="../nodes/images.html">图片</a>
                <a href="../nodes/audio.html">音频</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">CLI 与调试</span>
                <a href="../cli/index.html">CLI 参考</a>
                <a href="../debug/node-issue.html">Node 问题</a>
                <a href="../diagnostics/flags.html">诊断标志</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">实验性</span>
                <a href="../experiments/onboarding-config-protocol.html">配置协议</a>
            </div>
            <div class="nav-section">
                <span class="nav-section-title">其他</span>
                <a href="../help.html">帮助</a>
            </div>

            </div>
        </div>
    </nav>

    <div class="overlay" onclick="toggleNav()"></div>

    <main class="main-content">
        <div class="content">
            <h1>Telegram</h1>
<h1>Telegram（Bot API）</h1>
<p>状态：通过 grammY 支持 Bot 私聊 + 群组的生产就绪。默认长轮询；Webhook 可选。</p>
<h2>快速设置（初学者）</h2>
<ol>
<li>使用 <strong>@BotFather</strong> 创建 Bot 并复制 token。</li>
<li>设置 token：<ul>
<li>环境变量：<code>TELEGRAM_BOT_TOKEN=...</code></li>
<li>或配置：<code>channels.telegram.botToken: &quot;...&quot;</code>。</li>
<li>如果两者都设置，配置优先（环境变量回退仅用于默认账户）。</li>
</ul>
</li>
<li>启动 Gateway。</li>
<li>私聊访问默认是配对；首次联系时批准配对码。</li>
</ol>
<p>最小配置：</p>
<pre><code class="language-json5">{
  channels: {
    telegram: {
      enabled: true,
      botToken: &quot;123:abc&quot;,
      dmPolicy: &quot;pairing&quot;
    }
  }
}
</code></pre>
<h2>它是什么</h2>
<ul>
<li>Gateway 拥有的 Telegram Bot API 频道。</li>
<li>确定性路由：回复返回给 Telegram；模型从不选择频道。</li>
<li>私聊共享 Agent 的主会话；群组保持隔离（<code>agent:&lt;agentId&gt;:telegram:group:&lt;chatId&gt;</code>）。</li>
</ul>
<h2>设置（快速路径）</h2>
<h3>1) 创建 Bot Token（BotFather）</h3>
<ol>
<li>打开 Telegram 并与 <strong>@BotFather</strong> 聊天。</li>
<li>运行 <code>/newbot</code>，然后按照提示操作（名称 + 以 <code>bot</code> 结尾的用户名）。</li>
<li>复制 token 并安全存储。</li>
</ol>
<p>可选的 BotFather 设置：</p>
<ul>
<li><code>/setjoingroups</code> — 允许/拒绝将 Bot 添加到群组。</li>
<li><code>/setprivacy</code> — 控制 Bot 是否看到所有群组消息。</li>
</ul>
<h3>2) 配置 Token（环境变量或配置）</h3>
<p>示例：</p>
<pre><code class="language-json5">{
  channels: {
    telegram: {
      enabled: true,
      botToken: &quot;123:abc&quot;,
      dmPolicy: &quot;pairing&quot;,
      groups: { &quot;*&quot;: { requireMention: true } }
    }
  }
}
</code></pre>
<p>环境变量选项：<code>TELEGRAM_BOT_TOKEN=...</code>（适用于默认账户）。<br>如果环境变量和配置都设置，配置优先。</p>
<p>多账户支持：使用 <code>channels.telegram.accounts</code> 和每账户 token 及可选的 <code>name</code>。参见 [<code>gateway/configuration</code>(../gateway/configuration#telegramaccounts--discordaccounts--slackaccounts--signalaccounts--imessageaccounts.html) 了解共享模式。</p>
<ol start="3">
<li>启动 Gateway。Telegram 在 token 解析时启动（配置优先，环境变量回退）。</li>
<li>私聊访问默认为配对。Bot 首次被联系时批准代码。</li>
<li>对于群组：添加 Bot，决定隐私/管理员行为（如下），然后设置 <code>channels.telegram.groups</code> 来控制提及门控 + 白名单。</li>
</ol>
<h2>Token + 隐私 + 权限（Telegram 端）</h2>
<h3>Token 创建（BotFather）</h3>
<ul>
<li><code>/newbot</code> 创建 Bot 并返回 token（保密）。</li>
<li>如果 token 泄露，通过 @BotFather 撤销/重新生成并更新配置。</li>
</ul>
<h3>群组消息可见性（隐私模式）</h3>
<p>Telegram Bot 默认为<strong>隐私模式</strong>，这限制它们接收哪些群组消息。<br>如果你的 Bot 必须看到<em>所有</em>群组消息，你有两个选项：</p>
<ul>
<li>使用 <code>/setprivacy</code> 禁用隐私模式 <strong>或</strong></li>
<li>将 Bot 添加为群组<strong>管理员</strong>（管理员 Bot 接收所有消息）。</li>
</ul>
<p><strong>注意：</strong> 切换隐私模式时，Telegram 需要移除 + 重新添加 Bot<br>到每个群组以使更改生效。</p>
<h3>群组权限（管理员权限）</h3>
<p>管理员状态在群组内设置（Telegram UI）。管理员 Bot 总是接收所有<br>群组消息，因此如果你需要完全可见性，请使用管理员。</p>
<h2>工作原理（行为）</h2>
<ul>
<li>入站消息被标准化为共享频道信封，带有回复上下文和媒体占位符。</li>
<li>群组回复默认需要提及（原生 @提及或 <code>agents.list[].groupChat.mentionPatterns</code> / <code>messages.groupChat.mentionPatterns</code>）。</li>
<li>多 Agent 覆盖：在 <code>agents.list[].groupChat.mentionPatterns</code> 上设置每 Agent 模式。</li>
<li>回复总是路由回相同的 Telegram 聊天。</li>
<li>长轮询使用 grammY runner 和每聊天排序；整体并发由 <code>agents.defaults.maxConcurrent</code> 限制。</li>
<li>Telegram Bot API 不支持已读回执；没有 <code>sendReadReceipts</code> 选项。</li>
</ul>
<h2>格式化（Telegram HTML）</h2>

        </div>
    </main>

    <script src="../assets/js/main.js?v=3"></script>
</body>
</html>
